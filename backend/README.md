# Diet Code Backend - AI é¥®é£Ÿè§„åˆ’ Agent

åŸºäº Mastra æ¡†æ¶æ„å»ºçš„æ™ºèƒ½é¥®é£Ÿè§„åˆ’åç«¯æœåŠ¡ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Node.js 18+
- npm æˆ– yarn
- OpenAI API Key

### å®‰è£…æ­¥éª¤

1. **å®‰è£…ä¾èµ–**
```bash
npm install
```

2. **ç¯å¢ƒé…ç½®**
```bash
cp .env.example .env
```

3. **ç¼–è¾‘ .env æ–‡ä»¶**
```bash
# æ·»åŠ ä½ çš„ OpenAI API Key
OPENAI_API_KEY=your_openai_api_key_here
```

4. **å¯åŠ¨å¼€å‘æœåŠ¡å™¨**
```bash
npm run dev
```

æœåŠ¡å™¨å°†åœ¨ http://localhost:3001 å¯åŠ¨

## ğŸ“‹ å¯ç”¨è„šæœ¬

- `npm run dev` - å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼ˆçƒ­é‡è½½ï¼‰
- `npm run build` - æ„å»ºç”Ÿäº§ç‰ˆæœ¬
- `npm start` - å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
- `npm test` - è¿è¡Œæµ‹è¯•

## ğŸ”§ æŠ€æœ¯æ ˆ

- **æ¡†æ¶**: Express.js + TypeScript
- **AI Agent**: Mastra Framework
- **AI æ¨¡å‹**: OpenAI GPT-4
- **å†…å­˜ç®¡ç†**: Mastra MemoryManager
- **å®‰å…¨**: Helmet + CORS
- **å¼€å‘å·¥å…·**: ts-node-dev

## ğŸ“Š API ç«¯ç‚¹

### POST /api/chat
ä¸ AI è¥å…»é¡¾é—®èŠå¤©

**è¯·æ±‚ä½“**:
```json
{
  "userId": "string",
  "message": "string"
}
```

**å“åº”**:
```json
{
  "response": "AIå›å¤å†…å®¹"
}
```

### GET /api/health
å¥åº·æ£€æŸ¥ç«¯ç‚¹

**å“åº”**:
```json
{
  "status": "OK",
  "timestamp": "2025-08-15T14:56:25.000Z"
}
```

## ğŸ¤– Mastra Agent åŠŸèƒ½

### å†…ç½®å·¥å…· (Tools)

1. **calculateBMR** - åŸºç¡€ä»£è°¢ç‡è®¡ç®—
   - ä½¿ç”¨ Harris-Benedict å…¬å¼
   - è€ƒè™‘å¹´é¾„ã€æ€§åˆ«ã€ä½“é‡ã€èº«é«˜ã€æ´»åŠ¨æ°´å¹³

2. **generateMeal** - é¤é£Ÿç”Ÿæˆ
   - åŸºäºå¡è·¯é‡Œéœ€æ±‚
   - è€ƒè™‘é¥®é£Ÿé™åˆ¶å’Œè¿‡æ•ä¿¡æ¯
   - è¥å…»æˆåˆ†è‡ªåŠ¨è®¡ç®—

3. **saveUserPreferences** - ç”¨æˆ·åå¥½å­˜å‚¨
   - æœ¬åœ°å†…å­˜å­˜å‚¨
   - æ”¯æŒæŒä¹…åŒ–ï¼ˆå¯æ‰©å±•åˆ°æ•°æ®åº“ï¼‰

4. **getUserPreferences** - ç”¨æˆ·åå¥½è·å–
   - å¿«é€Ÿæ£€ç´¢ç”¨æˆ·è®¾ç½®
   - è‡ªåŠ¨ç¼“å­˜ç®¡ç†

5. **generateDietPlan** - å®Œæ•´é¥®é£Ÿè®¡åˆ’ç”Ÿæˆ
   - å¤šå¤©è®¡åˆ’æ”¯æŒ
   - è¥å…»å‡è¡¡åˆ†æ
   - ä¸ªæ€§åŒ–å»ºè®®

### Agent ç‰¹æ€§

- ğŸ§  æ™ºèƒ½å¯¹è¯ç†è§£
- ğŸ“Š ç§‘å­¦è¥å…»è®¡ç®—
- ğŸ½ï¸ ä¸ªæ€§åŒ–é¤é£Ÿæ¨è
- ğŸ’¾ ç”¨æˆ·åå¥½è®°å¿†
- ğŸ”„ æŒç»­å­¦ä¹ ä¼˜åŒ–

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ diet-planning-agent.ts  # ä¸» Agent å®ç°
â”‚   â”œâ”€â”€ server.ts              # Express æœåŠ¡å™¨
â”‚   â””â”€â”€ types/
â”‚       â””â”€â”€ index.ts           # TypeScript ç±»å‹å®šä¹‰
â”œâ”€â”€ package.json               # ä¾èµ–é…ç½®
â”œâ”€â”€ tsconfig.json             # TypeScript é…ç½®
â”œâ”€â”€ .env.example              # ç¯å¢ƒå˜é‡æ¨¡æ¿
â””â”€â”€ README.md                 # æœ¬æ–‡ä»¶
```

## ğŸ”’ ç¯å¢ƒå˜é‡

| å˜é‡å | å¿…éœ€ | è¯´æ˜ |
|--------|------|------|
| `OPENAI_API_KEY` | âœ… | OpenAI API å¯†é’¥ |
| `PORT` | âŒ | æœåŠ¡å™¨ç«¯å£ (é»˜è®¤: 3001) |
| `NODE_ENV` | âŒ | ç¯å¢ƒæ¨¡å¼ (é»˜è®¤: development) |
| `FRONTEND_URL` | âŒ | å‰ç«¯ URL (é»˜è®¤: http://localhost:3000) |

## ğŸ”§ é…ç½®è¯´æ˜

### Mastra é…ç½®
- ä½¿ç”¨ OpenAI GPT-4 ä½œä¸ºè¯­è¨€æ¨¡å‹
- æœ¬åœ°å†…å­˜å­˜å‚¨ï¼ˆå¯æ‰©å±•åˆ° Redis/Databaseï¼‰
- æ”¯æŒå·¥å…·è°ƒç”¨å’Œè®°å¿†ç®¡ç†

### Express é…ç½®
- CORS è·¨åŸŸæ”¯æŒ
- Helmet å®‰å…¨å¤´
- JSON è¯·æ±‚ä½“è§£æ
- é”™è¯¯å¤„ç†ä¸­é—´ä»¶

## ğŸš§ å¼€å‘æ³¨æ„äº‹é¡¹

1. **API Key**: ç¡®ä¿è®¾ç½®æœ‰æ•ˆçš„ OpenAI API Key
2. **å†…å­˜ç®¡ç†**: å½“å‰ä½¿ç”¨æœ¬åœ°å†…å­˜ï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ Redis
3. **é”™è¯¯å¤„ç†**: æ‰€æœ‰ API è°ƒç”¨éƒ½æœ‰é€‚å½“çš„é”™è¯¯å¤„ç†
4. **ç±»å‹å®‰å…¨**: å…¨ç¨‹ä½¿ç”¨ TypeScript ç¡®ä¿ç±»å‹å®‰å…¨

## ğŸ“ˆ æ‰©å±•è®¡åˆ’

- [ ] æ•°æ®åº“é›†æˆ (PostgreSQL/MongoDB)
- [ ] ç”¨æˆ·è®¤è¯ç³»ç»Ÿ (JWT)
- [ ] è¥å…»æ•°æ®åº“ API é›†æˆ
- [ ] æ›´å¤šé¥®é£Ÿè®¡åˆ’æ¨¡æ¿
- [ ] å¥åº·æ•°æ®è¿½è¸ª
- [ ] å¤šè¯­è¨€æ”¯æŒ

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼